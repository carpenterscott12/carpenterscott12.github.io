<!DOCTYPE html>

<head>
    <link rel="stylesheet" type="text/css" href="shared.css" />
    <link rel="stylesheet" type="text/css" href="stadium.css" />
</head>

<body>
    
</body>
<style>

</style>

<script>

    const types = ["rock", "paper", "scissors"];
    const damageCategories = ["a", "m"];
    const statusConditions = ["poison", "slowed"];
    const operators = ["add", "multiply"];
    const maxStatDelta = 6;
    const maxNumberOfMoves = 3;

    class Fighter {
        constructor(name, type, hp, attack, defense, magicAttack, magicDefense, speed, moves) {
            this._name = name;
            this._type = type;
            this._hp = hp;
            this._attack = attack;
            this._defense = defense;
            this._magicAttack = magicAttack;
            this._magicDefense = magicDefense;
            this._speed = speed;
            this._moves = moves;
            this._deltaAttack = 0;
            this._deltaDefense = 0;
            this._deltaMagicAttack = 0;
            this._deltaMagicDefense = 0;
            this._deltaSpeed = 0;
            this._isPoisoned = false;
            this._isSlowed = false;
        }
        
        useMove(moveIndex, target) {
            if (moveIndex >= maxNumberOfMoves) {
                console.log("Error: move index out of bounds!");
            }
            else {
                let move = this._moves[moveIndex];
                if (move._affectedByAccuracy) {
                    if (move._accuracy < 100) {
                        let accuracyRoll = getRandomIntInclusive(1, 100);
                        if (accuracyRoll > move._accuracy) {
                            console.log("The move missed!");
                            // TODO: conclude the move usage
                            return;
                        }
                        else {
                            if (move._causesDamageDirectly) {
                                // TODO: damage calcs
                            }
                            else if (move._inflictsStatus) {
                                if (move._statusToInflict) {
                                    if (move._targetsSelf) {
                                        // TODO: Inflict status on self
                                    }
                                    else if (move._targetsBothOpponents) {
                                        // TODO: Inflict status on both opponents
                                    }
                                    else if (move._targetsAllOtherFighters) {
                                        // TODO: Inflict status on all other fighters
                                    }
                                    else {
                                        // TODO: Inflict status on the selected target
                                    }
                                }
                                else {
                                    console.log("Error: the move tried to inflict status, but it did not have a valid value for statusToInflict");
                                }
                            }
                            else if (move._changesStatsWhenUsed) {

                            }
                        }
                    }
                }
                else {
                    if (move._causesDamageDirectly) {
                        // TODO: damage calcs
                    }
                }
            }
        }
    }

    class FighterMove {
        constructor(name, type, damageCategory, power, accuracy, affectedByAccuracy, causesDamageDirectly, inflictsStatus, 
            chanceToInflictStatus, statusToInflict, targetsSelf, targetsBothOpponents, targetsAllOtherFighters, changesStatsWhenUsed, halvesDamageToSelfOnNextHit,
            changeStatsOnNextHit, statsToChange) {
            this._name = name;
            this._type = type;
            this._damageCategory = damageCategory;
            this._power = power;
            this._accuracy = accuracy;
            this._affectedByAccuracy = affectedByAccuracy;
            this._causesDamageDirectly = causesDamageDirectly;
            this._inflictsStatus = inflictsStatus;
            this._chanceToInflictStatus = chanceToInflictStatus;
            this._statusToInflict = statusToInflict;
            this._targetsSelf = targetsSelf;
            this._targetsBothOpponents = targetsBothOpponents;
            this._targetsAllOtherFighters = targetsAllOtherFighters;
            this._changesStatsWhenUsed = changesStatsWhenUsed;
            this._halvesDamageToSelfOnNextHit = halvesDamageToSelfOnNextHit;
            this._changeStatsOnNextHit = changeStatsOnNextHit;
            this._statsToChange = statsToChange;
        }

        resolveTargets() {
            let targets = [];
            if (this._targetsSelf) {
                // TODO: Inflict status on self
            }
            else if (this._targetsBothOpponents) {
                // TODO: Inflict status on both opponents
            }
            else if (this._targetsAllOtherFighters) {
                // TODO: Inflict status on all other fighters
            }
            else {
                // TODO: Inflict status on the selected target
            }
        }
    }

    class StatChanges {
        constructor() {
            this._hp = hp;
            this._attack = attack;
            this._defense = defense;
            this._magicAttack = magicAttack;
            this._magicDefense = magicDefense;
            this._speed = speed;
        }
    }

    class Player {
        constructor(name) {
            this._name = name;
        }
    }

    function getRandomIntInclusive(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function startGame() {
        let move_heavyPunch = new FighterMove("Heavy Punch", "rock", "a", 90, 100, true, true, false, false, null, false, false, false, false, false, false, null);
        let move_poisonBlade = new FighterMove("Poison Blade", "scissors", "a", 70, 100, true, true, false, true, "poison", false, false, false, false, false, false, null);
        let fighter_kyle = new Fighter("Kyle Blastar", "rock", 100, 120, 80, 100, 120, 80, [move_heavyPunch]);
        console.log(fighter_kyle);
        let fighter_matt = new Fighter("Matt", "scissors", 100, 100, 100, 100, 100, 100, [move_poisonBlade]);
        console.log(fighter_matt);
    }


    // Main game:
    startGame();


</script>

</html>